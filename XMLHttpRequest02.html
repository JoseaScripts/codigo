<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Ejemplos de código para uso en proyectos de desarrollo">
  <meta name="keywords" content="proyectos,desarrollo,informática,logros,currículum vitae,HTML,CSS,JavaScript,JSON,Bootstrap">
  <meta name="author" content="José A. González">
  <title>José A. González: descarga de datos en JSON</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Tangerine">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata">
  <link rel="stylesheet" href="/css/XMLHttpRequest.css">
  <script type="text/javascript">
    const PROXYURL = "https://cors-anywhere.herokuapp.com/";
    const ENLACE = "https://www.elmundo.es/servicios/noticias/scroll/comentarios/comunidad/listar.html?noticia=1705996&version=v2"
    const ARCHIVO = PROXYURL + ENLACE;
  </script>
</head>
<body onload="tareas()">
  <div id="container">

    <header>
      <nav>
        <h1>Descarga de datos en JSON</h1>
        <a href="/">
          <div id="logo">
              <p>osé A. González &nbsp;</p>
          </div>
        </a>
      </nav>
    </header>

    <h2>Carga síncrona de datos con XMLHttpRequest y manejo de errores.</h2>
    <article>

      <div>Los datos abajo se han cargado de una fuente externa:</div>
      <div id="imprimir" class="imprimir"></div>
    </article>

    <div class="enlaces">
      <a href="https://github.com/JoseaScripts/codigo/blob/master/XMLHttpRequest02.html">
        Código publicado en <span id="github"></span>
      </a>
    </div>
    <div class="enlaces">
        Más info y detalles <a href="./XMLHttpRequest.html"><strong>aquí</strong>.</a>
    </div>

      <script>
      function tareas() {
        let z = document.lastModified;
        let x = `Documento actualizado el ${z}.`;
        let node = document.createElement("small");
        let textnode = document.createTextNode(x);
        node.appendChild(textnode);
        node.setAttribute("id", "modificado");
        document.getElementById('container').appendChild(node);
      }
        
      let elementoDOM = document.getElementById('imprimir')
      try {
        const DATOS = new XMLHttpRequest();
        DATOS.open("GET", ARCHIVO, false);
        DATOS.send();
        const OBJETO = JSON.parse(DATOS.responseText);
        ELEMENTO = OBJETO.items[Math.floor(Math.random() * 10)];
        elementoDOM.innerHTML = ELEMENTO.body
      }catch(e) {
        console.log('error: ', e)
        elementoDOM.innerHTML = e
      }

      </script>
  </div>
</body>
</html>
